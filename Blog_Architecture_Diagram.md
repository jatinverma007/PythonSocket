# Architecture Diagrams for Medium Blog

## 1. System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                        Chat Application                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   iOS App   │    │  Web Client │    │  Mobile Web │         │
│  │             │    │             │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                FastAPI Backend Server                       │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │   REST API  │  │  WebSocket  │  │   File      │         │ │
│  │  │   Routes    │  │  Handler    │  │   Upload    │         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │   Auth      │  │   Chat      │  │   User      │         │ │
│  │  │   Service   │  │   Service   │  │   Service   │         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  └─────────────────────────────────────────────────────────────┘ │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │  SQLite     │    │   File      │    │   JWT       │         │
│  │  Database   │    │   Storage   │    │   Tokens    │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
└─────────────────────────────────────────────────────────────────┘
```

## 2. Database Schema

```
┌─────────────────────────────────────────────────────────────────┐
│                        Database Schema                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │     Users       │    │   Chat Rooms    │    │   Messages   │ │
│  │                 │    │                 │    │              │ │
│  │  id (PK)        │    │  id (PK)        │    │  id (PK)     │ │
│  │  username       │    │  name           │    │  content     │ │
│  │  hashed_password│    │  created_at     │    │  message_type│ │
│  │  refresh_token  │    │                 │    │  file_url    │ │
│  │  refresh_expires│    │                 │    │  file_name   │ │
│  │  created_at     │    │                 │    │  file_size   │ │
│  └─────────────────┘    └─────────────────┘    │  mime_type   │ │
│         │                        │              │  timestamp   │ │
│         │                        │              │  room_id (FK)│ │
│         │                        │              │  sender_id(FK)│ │
│         │                        │              └──────────────┘ │
│         │                        │                       │       │
│         └────────────────────────┼───────────────────────┘       │
│                                  │                               │
│                                  ▼                               │
│                          ┌─────────────────┐                     │
│                          │   Relationships │                     │
│                          │                 │                     │
│                          │  User 1:N Msgs  │                     │
│                          │  Room 1:N Msgs  │                     │
│                          │  User N:N Rooms │                     │
│                          └─────────────────┘                     │
└─────────────────────────────────────────────────────────────────┘
```

## 3. WebSocket Message Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    WebSocket Message Flow                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   Client A  │    │   Server    │    │   Client B  │         │
│  │             │    │             │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         │ 1. Connect        │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │ 2. Accept         │                   │               │
│         │◄──────────────────┤                   │               │
│         │                   │                   │               │
│         │ 3. Send Message   │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │                   │ 4. Save to DB     │               │
│         │                   ├──────────────────►│               │
│         │                   │                   │               │
│         │                   │ 5. Broadcast      │               │
│         │                   ├──────────────────►│               │
│         │                   │                   │               │
│         │ 6. Receive        │                   │ 6. Receive    │
│         │◄──────────────────┤                   │◄──────────────┤
│         │                   │                   │               │
└─────────────────────────────────────────────────────────────────┘
```

## 4. Authentication Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                      Authentication Flow                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   Client    │    │   Server    │    │  Database   │         │
│  │             │    │             │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         │ 1. Login Request  │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │                   │ 2. Verify User    │               │
│         │                   ├──────────────────►│               │
│         │                   │                   │               │
│         │                   │ 3. User Data      │               │
│         │                   │◄──────────────────┤               │
│         │                   │                   │               │
│         │                   │ 4. Generate JWT   │               │
│         │                   │                   │               │
│         │ 5. Return Tokens  │                   │               │
│         │◄──────────────────┤                   │               │
│         │                   │                   │               │
│         │ 6. Store Tokens   │                   │               │
│         │                   │                   │               │
│         │ 7. API Requests   │                   │               │
│         │   with JWT        │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │ 8. Validate JWT   │                   │               │
│         │                   ├──────────────────►│               │
│         │                   │                   │               │
│         │ 9. Return Data    │                   │               │
│         │◄──────────────────┤                   │               │
└─────────────────────────────────────────────────────────────────┘
```

## 5. File Upload Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                       File Upload Flow                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   Client    │    │   Server    │    │ File System │         │
│  │             │    │             │    │             │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│         │                   │                   │               │
│         │ 1. Upload File    │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │                   │ 2. Validate File  │               │
│         │                   │                   │               │
│         │                   │ 3. Generate UUID  │               │
│         │                   │                   │               │
│         │                   │ 4. Save File      │               │
│         │                   ├──────────────────►│               │
│         │                   │                   │               │
│         │                   │ 5. File Saved     │               │
│         │                   │◄──────────────────┤               │
│         │                   │                   │               │
│         │ 6. Return URL     │                   │               │
│         │◄──────────────────┤                   │               │
│         │                   │                   │               │
│         │ 7. Send Message   │                   │               │
│         │   with File URL   │                   │               │
│         ├──────────────────►│                   │               │
│         │                   │                   │               │
│         │ 8. Broadcast      │                   │               │
│         │   to Room         │                   │               │
│         │◄──────────────────┤                   │               │
└─────────────────────────────────────────────────────────────────┘
```

## 6. API Endpoints Structure

```
┌─────────────────────────────────────────────────────────────────┐
│                      API Endpoints Structure                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Base URL: /api                          │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Authentication Routes                      │ │
│  │                                                             │ │
│  │  POST   /auth/signup        - Register new user            │ │
│  │  POST   /auth/login         - Login user                   │ │
│  │  POST   /auth/refresh       - Refresh access token         │ │
│  │  POST   /auth/logout        - Logout user                  │ │
│  │  GET    /auth/me            - Get current user info        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Chat Routes                              │ │
│  │                                                             │ │
│  │  GET    /rooms              - Get all chat rooms           │ │
│  │  POST   /rooms              - Create new chat room         │ │
│  │  GET    /rooms/{id}         - Get specific room            │ │
│  │  GET    /messages/{id}      - Get room messages            │ │
│  │  GET    /messages/{id}/recent - Get recent messages        │ │
│  │  POST   /upload-file        - Upload any file type         │ │
│  │  POST   /upload-image       - Upload image specifically    │ │
│  │  GET    /files/{filename}   - Serve uploaded files         │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  WebSocket Routes                           │ │
│  │                                                             │ │
│  │  WS     /ws/chat/{room_id}?token={jwt} - Real-time chat    │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 7. Message Types and Data Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                    Message Types and Data Flow                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Message Types                            │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │    TEXT     │  │    IMAGE    │  │    VIDEO    │         │ │
│  │  │             │  │             │  │             │         │ │
│  │  │  content    │  │  file_url   │  │  file_url   │         │ │
│  │  │  message    │  │  file_name  │  │  file_name  │         │ │
│  │  │             │  │  file_size  │  │  file_size  │         │ │
│  │  │             │  │  mime_type  │  │  mime_type  │         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │    AUDIO    │  │  DOCUMENT   │  │   SYSTEM    │         │ │
│  │  │             │  │             │  │             │         │ │
│  │  │  file_url   │  │  file_url   │  │  user_joined│         │ │
│  │  │  file_name  │  │  file_name  │  │  user_left  │         │ │
│  │  │  file_size  │  │  file_size  │  │  connected  │         │ │
│  │  │  mime_type  │  │  mime_type  │  │  error      │         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Data Flow                                │ │
│  │                                                             │ │
│  │  Client → WebSocket → Server → Database → Broadcast        │ │
│  │     ↑                                                    ↓  │ │
│  │  Display ← JSON ← WebSocket ← Server ← All Clients         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 8. Security Layers

```
┌─────────────────────────────────────────────────────────────────┐
│                        Security Layers                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Client Side                              │ │
│  │                                                             │ │
│  │  • JWT Token Storage (Secure Storage)                      │ │
│  │  • Input Validation                                        │ │
│  │  • File Type Validation                                    │ │
│  │  • File Size Limits                                        │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Network Layer                              │ │
│  │                                                             │ │
│  │  • HTTPS/WSS (Production)                                  │ │
│  │  • CORS Configuration                                      │ │
│  │  • Rate Limiting                                           │ │
│  │  • Request Validation                                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Application Layer                          │ │
│  │                                                             │ │
│  │  • JWT Token Verification                                  │ │
│  │  • Password Hashing (bcrypt)                               │ │
│  │  • File Upload Validation                                  │ │
│  │  • SQL Injection Prevention (SQLAlchemy ORM)              │ │
│  │  • XSS Prevention                                          │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                   Data Layer                                │ │
│  │                                                             │ │
│  │  • Database Access Control                                 │ │
│  │  • File System Permissions                                 │ │
│  │  • Data Encryption (at rest)                               │ │
│  │  • Backup and Recovery                                     │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 9. Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Deployment Architecture                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Load Balancer                            │ │
│  │                                                             │ │
│  │  • Nginx/HAProxy                                           │ │
│  │  • SSL Termination                                         │ │
│  │  • Rate Limiting                                           │ │
│  │  • Static File Serving                                     │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Application Servers                        │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │   Server 1  │  │   Server 2  │  │   Server N  │         │ │
│  │  │             │  │             │  │             │         │ │
│  │  │  FastAPI    │  │  FastAPI    │  │  FastAPI    │         │ │
│  │  │  WebSocket  │  │  WebSocket  │  │  WebSocket  │         │ │
│  │  │  File Upload│  │  File Upload│  │  File Upload│         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    Data Layer                               │ │
│  │                                                             │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │ │
│  │  │ PostgreSQL  │  │ Redis Cache │  │ File Storage│         │ │
│  │  │ Database    │  │ (Sessions)  │  │ (S3/MinIO)  │         │ │
│  │  └─────────────┘  └─────────────┘  └─────────────┘         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 10. Development vs Production

```
┌─────────────────────────────────────────────────────────────────┐
│                Development vs Production                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Development                                │ │
│  │                                                             │ │
│  │  • SQLite Database                                         │ │
│  │  • Local File Storage                                      │ │
│  │  • HTTP/WS (no SSL)                                        │ │
│  │  • Auto-reload Enabled                                     │ │
│  │  • Debug Logging                                           │ │
│  │  • CORS: Allow All Origins                                 │ │
│  │  • Single Server Instance                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                │                                │
│                                ▼                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                  Production                                 │ │
│  │                                                             │ │
│  │  • PostgreSQL Database                                     │ │
│  │  • Cloud File Storage (S3)                                 │ │
│  │  • HTTPS/WSS (SSL/TLS)                                     │ │
│  │  • Process Management (Gunicorn)                           │ │
│  │  • Structured Logging                                      │ │
│  │  │  • CORS: Specific Origins                               │ │
│  │  │  • Load Balancer                                        │ │
│  │  │  • Redis for Session Storage                            │ │
│  │  │  • Monitoring & Health Checks                           │ │
│  │  │  • Backup Strategy                                      │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```
